<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persona Tensei : Down Hellwhole</title>
    <style>
    /* Define a color palette using CSS variables */
    :root {
        --main-red: #d90429;
        --dark-bg: #1e1e1e;
        --light-text: #edf2f4;
        --dark-panel: #2b2d42;
        --border-color: #8d99ae;
    }

    body {
        font-family: 'Poppins', sans-serif; /* Use the new font */
        background-color: var(--dark-bg);
        color: var(--light-text);
        text-align: center;
        margin: 0;
        padding: 20px;
    }

    #game-container {
        max-width: 900px;
        margin: auto;
    }

    h1, h3, h4 {
        text-transform: uppercase;
        letter-spacing: 2px;
        color: var(--main-red);
    }

    /* The main game screen layout */
    #game-screen {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto 1fr;
        grid-template-areas: 
            "player enemy"
            "actions actions";
        gap: 20px;
        margin-top: 20px;
    }

    /* Styling for the player and enemy panels */
    #player-stats, #enemy-display {
        background-color: var(--dark-panel);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        padding: 15px;
    }
    #player-stats { grid-area: player; }
    #enemy-display { grid-area: enemy; }

    #actions {
        grid-area: actions;
        padding-top: 20px;
        border-top: 2px dashed var(--main-red);
    }

    .icon {
        width: 120px;
        height: auto;
        margin-bottom: 10px;
    }

    button {
        background-color: var(--main-red);
        color: var(--light-text);
        border: 2px solid var(--light-text);
        padding: 10px 20px;
        cursor: pointer;
        font-size: 16px;
        font-family: 'Poppins', sans-serif;
        margin: 5px;
        transition: all 0.2s ease-in-out;
    }

    button:hover {
        background-color: var(--light-text);
        color: var(--main-red);
    }

    ul {
        list-style-type: none;
        padding: 0;
        text-align: left;
        max-width: 200px;
        margin: 10px auto;
    }

    /* --- Health & SP Bar Styles --- */
    .stat-bar {
        background-color: var(--dark-bg);
        border: 1px solid var(--border-color);
        border-radius: 5px;
        height: 20px;
        width: 90%;
        margin: 5px auto;
        overflow: hidden; /* Ensures the fill doesn't spill out */
    }
    .hp-fill {
        background-color: #2a9d8f; /* A teal color for HP */
        height: 100%;
        transition: width 0.3s ease-out;
    }
    .sp-fill {
        background-color: #e76f51; /* An orange color for SP */
        height: 100%;
        transition: width 0.3s ease-out;
    }
</style>
</head>
<body>
    <div id="game-container">
        <div id="start-screen"></div>
        <div id="game-screen" style="display: none;">
            <div id="player-stats"></div>
            <div id="enemy-display"></div>
            <div id="actions"></div>
        </div>
    </div>
</body>
<script>
    // Persona
    const PERSONAS = {
        Orpheus: { HP: 70, SP: 30, STATS:{STR: 5, MAG:3, END: 4, AGI: 5, LUK: 3}, ABILITY:["bash", "agi"], img:"./img/Orpheus.png"},
        Izanagi: { HP: 80, SP: 25, STATS:{STR: 6, MAG:2, END: 5, AGI: 4, LUK: 3}, ABILITY:["bash", "zio"], img:"./img/Izanagi.png"},
        Arsene: { HP: 65, SP: 35, STATS:{STR: 4, MAG:4, END: 3, AGI: 6, LUK: 5}, ABILITY:["bash", "agi"], img:"./img/Arsene.png"}
    }

    // Demon
    const DEMONS = [
        {name:"Pixie", HP: 30, SP: 20, STATS:{STR: 3, MAG:5, END: 2, AGI: 6, LUK: 4}, ABILITY:["zio"], img:"./img/Pixie.webp"}
    ]

    // Skill
    const SKILLS = {
        // Physical skills
        bash: {name: "Bash", cost: {hp:4}, power:10, type:"physical"},

        // Magic skills
        agi: { name: "Agi", cost: {sp:4}, power: 12, type: "magic" },
        zio: { name: "Zio", cost: {sp:4}, power: 12, type: "magic" },
    };

    // Starting State
    let state = {
        playerName:null,
        enemy:null,
        inventory:[],
        xp:0,
        level:1,
        persona:null
    };

    // How enemies are chosen
    function pickEnemy() {
        return JSON.parse(JSON.stringify(DEMONS[Math.floor(Math.random()*DEMONS.length)]));
    }

    //Main menu
    function mainMenu() {
        const div = document.getElementById("start-screen");
        let newButton = document.createElement("button");
        newButton.textContent = "New Game";
        newButton.onclick =() => personaSelect();
        div.appendChild(newButton);
        let loadButton = document.createElement("button");
        loadButton.textContent = "Load Save";
        loadButton.onclick = () => alert("Not implemented yet!");
        div.appendChild(loadButton);
    }

    // Selecting Persona
    function personaSelect() {
        const div = document.getElementById("start-screen");
        div.innerHTML = "<h4>Choose your Persona</h4>";
        Object.keys(PERSONAS).forEach (c => {
            let btn = document.createElement("button");
            btn.innerHTML=`<img src='${PERSONAS[c].img}' class='icon'> ${c}`;
            btn.onclick = () => startGame(c);
            div.appendChild(btn);
        })
    }

    // Starting the game
    function startGame(personaName) {
        const base = PERSONAS[personaName];
        state.persona = JSON.parse(JSON.stringify(base));
        state.persona.name = personaName;
        state.persona.maxHP = base.HP;
        state.persona.maxSP = base.SP;
        document.getElementById("start-screen").style.display = 'none';
        document.getElementById("game-screen").style.display = 'grid';
        spawnEnemy();
        render();
    }

    // Render all game info
    function render() {
        if (!state.persona) return;
        const playerStatsDiv = document.getElementById("player-stats");
        let p = state.persona;
        const hpPercent = (p.HP / p.maxHP) * 100;
        const spPercent = (p.SP / p.maxSP) * 100;
        playerStatsDiv.innerHTML = `
            <h3>${p.name}</h3>
            <img src='${p.img}' alt='${p.name}' class='icon'>
            <p>HP: ${p.HP} / ${p.maxHP}</p>
            <div class="stat-bar">
                <div class="hp-fill" style="width: ${hpPercent}%;"></div>
            </div>
            <p>SP: ${p.SP} / ${p.maxSP}</p>
            <div class="stat-bar">
                <div class="sp-fill" style="width: ${spPercent}%;"></div>
            </div>
        <ul>
            <li>STR: ${p.STATS.STR}</li>
            <li>MAG: ${p.STATS.MAG}</li>
            <li>END: ${p.STATS.END}</li>
            <li>AGI: ${p.STATS.AGI}</li>
            <li>LUK: ${p.STATS.LUK}</li>
        </ul>
        `;
        const enemyDisplayDiv = document.getElementById("enemy-display");
        if (state.enemy) {
            let e = state.enemy;
            enemyDisplayDiv.innerHTML = `
                <h3>${e.name}</h3>
                <img src='${e.img}' alt='${e.name}' class='icon'>
                <p>HP: ${e.HP}</p>
            `;
        }
        const actionsDiv = document.getElementById("actions");
        actionsDiv.innerHTML = `<button onclick="attack()">Attack</button>`;
        p.ABILITY.forEach(skillKey => {
            const skill = SKILLS[skillKey]; 
            if (!skill) return; 
            let costDisplay = "";
            if (skill.cost.hp) {
                costDisplay = `${skill.cost.hp} HP`;
            } else if (skill.cost.sp) {
                costDisplay = `${skill.cost.sp} SP`;
            }
            let skillButton = document.createElement("button");
            skillButton.innerHTML = `${skill.name} <br> (${costDisplay})`;
            skillButton.onclick = () => useAbility(skillKey);
            actionsDiv.appendChild(skillButton);
        });
    }

    // attack
    function attack() {
        let dmg = Math.max(1, state.persona.STATS.STR - state.enemy.STATS.END);
        state.enemy.HP -= dmg;
        if (state.enemy.HP <= 0) {
            enemyDefeated();
            return;
        }
        enemyTurn();
        render();
    }
    // use Ability
    function useAbility(skillKey){
        const skill = SKILLS[skillKey];
        const player = state.persona;
        const enemy = state.enemy;

        if (skill.cost.sp && player.SP < skill.cost.sp) {
            return;
        }
        if (skill.cost.hp && player.HP < skill.cost.hp) {
            return;
        }

        if (skill.cost.sp) {
            player.SP -= skill.cost.sp;
        }
        if (skill.cost.hp) {
            player.HP -= skill.cost.hp;
        }

        let dmg = 0;
        if (skill.type === 'physical') {
            dmg = Math.max(1, skill.power + player.STATS.STR - enemy.STATS.END);
        } else if (skill.type === 'magic') {
            dmg = Math.max(1, skill.power + player.STATS.MAG - enemy.STATS.END);
        }

        enemy.HP -= dmg;

        if (enemy.HP <= 0) {
            enemyDefeated();
            return;
        }

        enemyTurn();
        render();
    }

    // Spawning Enemy
    function spawnEnemy() {
        state.enemy = pickEnemy();
    }

    // Enemy turn to attack
    function enemyTurn() {
        let dmg = Math.max(1, state.enemy.STATS.STR - state.persona.STATS.END);
        state.persona.HP -= dmg;
        if (state.persona.HP <= 0) {
            alert("You have been defeated.");
            document.location.reload();
        }
    }
    // Enemy dies
    function enemyDefeated(){
        state.xp+=10;
        if(state.xp>=state.level*20){
        state.level++;
        state.persona.maxHP += 5; 
        state.persona.maxSP += 2;
        state.persona.HP = state.persona.maxHP;
        state.persona.SP = state.persona.maxSP;
        }
        spawnEnemy();
        render();
    }
    
    // Game Start
    mainMenu();
</script>
</html>
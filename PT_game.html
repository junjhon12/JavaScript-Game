<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persona Tensei : Down Hellwhole</title>
</head>
<body>
    <div id="game-container">
        <div id="start-screen"></div>
        <div id="game-screen" style="display: none;">
            <div id="player-stats"></div>
            <div id="enemy-display"></div>
            <div id="actions"></div>
        </div>
    </div>
</body>
<script>
    // Persona
    const PERSONAS = {
        Orpheus: { HP: 70, SP: 30, STATS:{STR: 1, MAG:1, END: 1, AGI: 1, LUK: 1}, ABILITY:["Melee", "Spell", "", "", "", ""], img:"./img/Orpheus.png"},
        Izanagi: { HP: 70, SP: 30, STATS:{STR: 1, MAG:1, END: 1, AGI: 1, LUK: 1}, ABILITY:["Melee", "Spell", "", "", "", ""], img:"./img/Izanagi.png"},
        Arsene: { HP: 70, SP: 30, STATS:{STR: 1, MAG:1, END: 1, AGI: 1, LUK: 1}, ABILITY:["Melee", "Spell", "", "", "", ""], img:"./img/Arsene.png"}
    }

    // Demon's
    const DEMONS = [
        {name:"Pixie", HP: 30, SP: 20, STATS:{STR: 1, MAG:1, END: 1, AGI: 1, LUK: 1}, ABILITY:["Melee", "Spell", "", "", "", ""], img:"./img/Pixie.webp"}
    ]

    // Loot
    const LOOT = [
        {name:"Bead", use: function(Persona) {
            Persona.SP += Math.min(Persona.SP + 10, Persona.SP);
        }}
    ]

    // Starting State
    let state = {
        playerName:null,
        enemy:null,
        inventory:[],
        xp:0,
        level:1,
        persona:null
    };

    // How enemies are chosen
    function pickEnemy() {
        return JSON.parse(JSON.stringify(DEMONS[Math.floor(Math.random()*DEMONS.length)]));
    }

    // Loot drops
    function lootPickOptions(count=2) {
        let arr=[];
        for (let i = 0; i < count; i++) arr.push(LOOT[Math.floor(Math.random()*LOOT.length)]);
        return arr;
    }

    //Main menu
    function mainMenu() {
        const div = document.getElementById("start-screen");
        let newButton = document.createElement("button");
        newButton.textContent = "New Game";
        newButton.onclick =() => personaSelect();
        div.appendChild(newButton);
        let loadButton = document.createElement("button");
        loadButton.textContent = "Load Save";
        loadButton.onclick = () => alert("Not implemented yet!");
        div.appendChild(loadButton);
    }

    // Selecting Persona
    function personaSelect() {
        const div = document.getElementById("start-screen");
        div.innerHTML = "<h4>Choose your Persona</h4>";
        Object.keys(PERSONAS).forEach (c => {
            let btn = document.createElement("button");
            btn.innerHTML=`<img src='${PERSONAS[c].img}' class='icon'> ${c}`;
            btn.onclick = () => startGame(c);
            div.appendChild(btn);
        })
    }

    // Starting the game
    function startGame(personaName) {
        const base = PERSONAS[personaName];
        state.persona = JSON.parse(JSON.stringify(base));
        state.persona.name = personaName;
        state.persona.maxHP = base.HP;
        state.persona.maxSP = base.SP;
        document.getElementById("start-screen").style.display = 'none';
        document.getElementById("game-screen").style.display = 'grid';
        spawnEnemy();
        render();
    }

    // Render all game info
    function render() {
        if (!state.persona) return;
        const playerStatsDiv = document.getElementById("player-stats");
        let p = state.persona;
        playerStatsDiv.innerHTML = `
            <h3>${p.name}</h3>
            <img src='${p.img}' alt='${p.name}' class='icon'>
            <p>HP: ${p.HP} / ${p.maxHP}</p>
            <p>SP: ${p.SP} / ${p.maxSP}</p>
        <ul>
            <li>STR: ${p.STATS.STR}</li>
            <li>MAG: ${p.STATS.MAG}</li>
            <li>END: ${p.STATS.END}</li>
            <li>AGI: ${p.STATS.AGI}</li>
            <li>LUK: ${p.STATS.LUK}</li>
        </ul>
        `;

        const enemyDisplayDiv = document.getElementById("enemy-display");
        if (state.enemy) {
            let e = state.enemy;
            enemyDisplayDiv.innerHTML = `
                <h3>${e.name}</h3>
                <img src='${e.img}' alt='${e.name}' class='icon'>
                <p>HP: ${e.HP}</p>
            `;
        }

        const actionsDiv = document.getElementById("actions");
        actionsDiv.innerHTML = `<button onclick="attack()">Attack</button>`;
    }

    // attack
    function attack() {
        let dmg = Math.max(1, state.persona.STR - state.enemy.END);
        state.enemy.HP -= dmg;
        if (state.enemy.HP <= 0) {
            enemyDefeated();
            return;
        }
        enemyTurn();
        render();
    }
    // use Ability
    function useAbility(){

    }
    // Rest
    function rest() {

    }
    // Enemy turn to attack
    function enemyTurn() {
        let dmg=Math.max(1, state.enemy.attack - state.player.END);
        state.persona.hp -= dmg;
    }
    // Enemy dies
    function enemyDefeated(){
        state.xp+=10;
        if(state.xp>=state.level*20){
        state.level++;
        state.player.maxhp+=2;
        state.player.hp=state.player.maxhp;
        //Random stat+1
        }
        showLootOptions();
    }
    
    // Game Start
    mainMenu();
</script>
</html>